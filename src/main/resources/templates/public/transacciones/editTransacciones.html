<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">

<head>
    <title>Edit Transacciones</title>
    <link rel="stylesheet" th:href="@{/css/main.css}">
    <link rel="stylesheet" th:href="@{/css/transacciones.css}">
</head>

<body>
    <div class="navbar">

        <img th:src="@{/img/LogoHorizontal.png}" style="width:15vw;">

        <div class="navbarTextMiniLogo">
            <p class="navButton" id="navButtonInicio" onclick="goToIndex()">Inicio</p>
            <img th:src="@{/img/LogoSoloBarra.png}" id="navImgInicio" style="width: 2rem; display:none">
        </div>

        <div class="navbarTextMiniLogo">
            <p class="navButton" id="navButtonTransacciones" onclick="goToTransacciones()">Transacciones</p>
            <img th:src="@{/img/LogoSoloBarra.png}" id="navImgTransacciones" style="width: 2rem; display:none">
        </div>

        <div class="navbarTextMiniLogo">
            <p class="navButton" id="navButtonRetos" onclick="goToRetos()">Retos</p>
            <img th:src="@{/img/LogoSoloBarra.png}" id="navImgRetos" style="width: 2rem; display:none">
        </div>

        <div class="navbarTextMiniLogo">
            <p class="navButton" id="navButtonInversiones" onclick="goToInversiones()">Inversiones</p>
            <img th:src="@{/img/LogoSoloBarra.png}" id="navImgInversiones" style="width: 2rem; display:none">
        </div>

        <div class="navbarTextMiniLogo">
            <p class="navButton" id="navButtonPresupuestos" onclick="goToPresupuesto()">Presupuestos</p>
            <img th:src="@{/img/LogoSoloBarra.png}" id="navImgPresupuesto" style="width: 2rem; display:none">
        </div>

        <div class="navbarTextMiniLogo">
            <p class="navButton" id="navButtonPerfil" onclick="goToPerfil()">Perfil</p>
            <img th:src="@{/img/LogoSoloBarra.png}" id="navImgPerfil" style="width: 2rem; display:none">
        </div>

        <p id="textoPruebaRuta" style="position:absolute; top:-2.5rem; right:20.5rem; color: rgb(160, 167, 164);"></p>

    </div>

    <div class="contenido">
        <div class="transacciones-container">
            <!-- Sección de historial (izquierda) -->
            <div class="historial-section">
                <h2>Historial de Transacciones</h2>

                <!-- Filtros por mes -->
                <div class="filtros-container">
                    <button class="filtro-mes active">Octubre</button>
                    <button class="filtro-mes">Categoria</button>
                    <button class="filtro-mes">Tipo</button>
                    <button class="filtro-mes">Cantidad</button>
                    <button class="filtro-mes">Mes</button>
                </div>

                <!-- Tabla de transacciones -->
                <div class="tabla-container">
                    <table class="tabla-historial">
                        <thead>
                        <tr>
                            <th class="col-fecha">Fecha</th>
                            <th class="col-categoria">Categoria</th>
                            <th class="col-tipo">Tipo</th>
                            <th class="col-cantidad">Cantidad</th>
                            <th class="col-descripcion">Informacion</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="row: ${historicoTransferencias}"
                            th:attr="data-id=${row.id}"
                            th:classappend="${row.id == transaccion.id} ? 'selected' : ''">
                            <td class="col-fecha" th:text="${#temporals.format(row.fechaTransaccion, 'dd/MM/yyyy')}"></td>
                            <td class="col-categoria" th:text="${row.categoriaTransferenciaNombre}"></td>
                            <td class="col-tipo" th:text="${row.tipoTransferenciaNombre}"
                                th:classappend="${row.tipoTransferenciaNombre == 'Ingreso'} ? 'tipo-ingreso' : 'tipo-gasto'"></td>
                            <td class="col-cantidad" th:text="${#numbers.formatDecimal(row.cantidad, 1, 2)} + '€'"></td>
                            <td class="col-descripcion" th:text="${row.descripcion}" th:title="${row.descripcion}"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Sección del formulario de edición (derecha) -->
            <div class="form-section">
                <h2>Editar Transaccion</h2>

                <div class="form-container-trans">
                    <form method="post" th:object="${transaccion}">
                        <input type="hidden" th:field="*{id}" />

                        <div class="form-group">
                            <label for="fecha">Fecha*</label>
                            <input id="fecha" type="date" name="fechaTransaccion"
                                   th:value="${transaccion.fechaTransaccion != null ? #temporals.format(transaccion.fechaTransaccion,'yyyy-MM-dd') : ''}"
                                   required />
                        </div>

                        <div class="form-group">
                            <label for="categoria">Categoria*</label>
                            <select id="categoria" name="categoriaTransferenciaId"
                                    th:field="*{categoriaTransferenciaId}" required>
                                <option value="" disabled>Selecciona una categoría</option>
                                <option th:each="c : ${categoriaTransferencia}"
                                        th:value="${c.id}"
                                        th:text="${c.name}"></option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="tipo">Tipo*</label>
                            <select id="tipo" name="tipoTransferenciaId"
                                    th:field="*{tipoTransferenciaId}" required>
                                <option value="" disabled>Selecciona un tipo</option>
                                <option th:each="t : ${tiposTransferencia}"
                                        th:value="${t.id}"
                                        th:text="${t.name}"></option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="cantidad">Cantidad*</label>
                            <input id="cantidad" type="number" name="cantidad"
                                   step="0.01" min="0" inputmode="decimal"
                                   th:field="*{cantidad}" required />
                        </div>

                        <div class="form-group">
                            <label for="descripcion">Informacion</label>
                            <input id="descripcion" type="text" name="descripcion"
                                   th:field="*{descripcion}" />
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Editar Transaccion</button>
                        </div>
                    </form>

                    <!-- Botones adicionales -->
                    <div class="form-actions" style="margin-top: 1rem;">
                        <button type="button" class="btn btn-secondary" onclick="goToTransacciones()">
                            Crear Nueva Transaccion
                        </button>

                        <form th:action="@{'/transacciones/edit/' + ${transaccion.id} + '/delete'}"
                              method="post" style="flex: 1;">
                            <button type="submit" class="btn btn-danger" style="width: 100%;"
                                    onclick="return confirm('¿Eliminar la transacción?')">
                                Eliminar Transaccion
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>


<!--Script-->
<script th:src="@{/js/navText.js}"></script>
<script th:src="@{/js/navigate.js}"></script>

<!-- Clickable en table-->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const rows = document.querySelectorAll('.row-selectable');
        rows.forEach(row => {
            row.addEventListener('click', () => {
                rows.forEach(r => r.classList.remove('selected'));
                row.classList.add('selected');
                const id = row.dataset.id;
                window.location.href = `/transacciones/edit/${id}`;
            });
        });
    });
</script>

</html>