<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">

<head>
    <title>Transacciones</title>
    <link rel="stylesheet" th:href="@{/css/main.css}">
    <link rel="stylesheet" th:href="@{/css/transacciones.css}">
</head>

<body>
    <div class="navbar">

        <img th:src="@{/img/LogoHorizontal.png}" style="width:15vw;">

        <div class="navbarTextMiniLogo">
            <p class="navButton" id="navButtonInicio" onclick="goToIndex()">Inicio</p>
            <img th:src="@{/img/LogoSoloBarra.png}" id="navImgInicio" style="width: 2rem; display:none">
        </div>

        <div class="navbarTextMiniLogo">
            <p class="navButton" id="navButtonTransacciones" onclick="goToTransacciones()">Transacciones</p>
            <img th:src="@{/img/LogoSoloBarra.png}" id="navImgTransacciones" style="width: 2rem; display:none">
        </div>

        <div class="navbarTextMiniLogo">
            <p class="navButton" id="navButtonRetos" onclick="goToRetos()">Retos</p>
            <img th:src="@{/img/LogoSoloBarra.png}" id="navImgRetos" style="width: 2rem; display:none">
        </div>

        <div class="navbarTextMiniLogo">
            <p class="navButton" id="navButtonInversiones" onclick="goToInversiones()">Inversiones</p>
            <img th:src="@{/img/LogoSoloBarra.png}" id="navImgInversiones" style="width: 2rem; display:none">
        </div>

        <div class="navbarTextMiniLogo">
            <p class="navButton" id="navButtonPresupuestos" onclick="goToPresupuesto()">Presupuestos</p>
            <img th:src="@{/img/LogoSoloBarra.png}" id="navImgPresupuesto" style="width: 2rem; display:none">
        </div>

        <div class="navbarTextMiniLogo">
            <p class="navButton" id="navButtonPerfil" onclick="goToPerfil()">Perfil</p>
            <img th:src="@{/img/LogoSoloBarra.png}" id="navImgPerfil" style="width: 2rem; display:none">
        </div>

    </div>

    <div class="contenido" style="margin-top:3rem;">
        <div class="transacciones-container">
            <!-- Sección de historial (izquierda) -->
            <div class="historial-section">
                <h2>Historial de Transacciones</h2>

                <!-- Filtros por mes y año -->
                <div class="filtros-container">
                    <select id="filtroMes" class="filtro-select">
                        <option value="">Mes</option>
                        <option value="1">Enero</option>
                        <option value="2">Febrero</option>
                        <option value="3">Marzo</option>
                        <option value="4">Abril</option>
                        <option value="5">Mayo</option>
                        <option value="6">Junio</option>
                        <option value="7">Julio</option>
                        <option value="8">Agosto</option>
                        <option value="9">Septiembre</option>
                        <option value="10">Octubre</option>
                        <option value="11">Noviembre</option>
                        <option value="12">Diciembre</option>
                    </select>

                    <select id="filtroAnio" class="filtro-select">
                        <option value="">Año</option>
                        <option value="2024">2024</option>
                        <option value="2025">2025</option>
                        <option value="2026">2026</option>
                    </select>
                </div>

                <!-- Tabla de transacciones -->
                <div class="tabla-container">
                    <table class="tabla-historial">
                        <thead>
                        <tr>
                            <th class="col-fecha">Fecha</th>
                            <th class="col-categoria">Categoria</th>
                            <th class="col-tipo">Tipo</th>
                            <th class="col-cantidad">Cantidad</th>
                            <th class="col-descripcion">Información</th>
                        </tr>
                        </thead>
                        <tbody id="historialBody">
                        <tr th:each="row: ${historicoTransferencias}" th:attr="data-id=${row.id}" class="row-selectable">
                            <td class="col-fecha" th:text="${#temporals.format(row.fechaTransaccion, 'dd/MM/yyyy')}"></td>
                            <td class="col-categoria" th:text="${row.categoriaTransferenciaNombre}"></td>
                            <td class="col-tipo" th:text="${row.tipoTransferenciaNombre}"
                                th:classappend="${row.tipoTransferenciaNombre == 'Ingreso'} ? 'tipo-ingreso' : 'tipo-gasto'"></td>
                            <td class="col-cantidad" th:text="${#numbers.formatDecimal(row.cantidad, 1, 2)} + '€'"></td>
                            <td class="col-descripcion" th:text="${row.descripcion}" th:title="${row.descripcion}"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Sección del formulario (derecha) -->
            <div class="form-section">
                <h2>Añadir Transaccion</h2>

                <div class="form-container-trans">
                    <form method="post">
                        <div class="form-group">
                            <label for="fecha">Fecha*</label>
                            <input id="fecha" type="date" name="fechaTransaccion" required />
                        </div>

                        <div class="form-group">
                            <label for="tipo">Tipo*</label>
                            <select id="tipo" name="tipoTransferenciaId" required>
                                <option value="" disabled selected>Selecciona un tipo</option>
                                <option th:each="t : ${tiposTransferencia}" th:value="${t.id}" th:text="${t.name}"></option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="categoria">Categoria*</label>
                            <select id="categoria" name="categoriaTransferenciaId" required>
                                <option value="" disabled selected>Selecciona una categoría</option>
                                <option th:each="c : ${categoriaTransferencia}" th:value="${c.id}" th:text="${c.name}"></option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="cantidad">Cantidad*</label>
                            <input id="cantidad" type="number" name="cantidad" step="0.01" min="0"
                                   inputmode="decimal" placeholder="0.00€" required />
                        </div>

                        <div class="form-group">
                            <label for="descripcion">Informacion</label>
                            <input id="descripcion" type="text" name="descripcion"
                                   placeholder="Información adicional..." />
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Crear Transaccion</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

</body>


<!--Script-->
<script th:src="@{/js/navText.js}"></script>
<script th:src="@{/js/navigate.js}"></script>
<script th:src="@{/js/transacciones.js}"></script>


<script>
    document.addEventListener('DOMContentLoaded', () => {
        const rows = document.querySelectorAll('.row-selectable');
        rows.forEach(row => {
            row.addEventListener('click', () => {
                rows.forEach(r => r.classList.remove('selected'));
                row.classList.add('selected');
                const id = row.dataset.id;
                window.location.href = `/transacciones/edit/${id}`;
            });
        });
    });
</script>
</html>